<!DOCTYPE html>
<html>

    <head>
	<title>PTV</title>

	<!-- This is the JS Grid references -->
	<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.min.css" />
	<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid-theme.min.css" />
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.min.js"></script>


	<!-- This is the CDN to JQuery - Found / copied by me -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

	<!-- This replace the JS Grid files -->
	<script type="text/javascript" src=https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.js
	<script type="text/javascript" src="jsgrid.min.js"></script>

	<!-- This is where the records are stored, just used them hardcoded below for now --> 
	<link type="text" href="records" />

    </head>
	
	
    <body>
	<!-- This puts grid on page -->
	<div id="jsGrid1"></div>
	
	<!-- I had a second tester grid in here for comparing / playing -->
	<!-- Might still use this for the duplicate values report -->
	<!-- 
	<div id="jsGrid2"></div>
	-->

	<!-- Button to run the find duplicates report -->
	<div>
		<button id="run_report" onclick="report_duplicates()">Find Duplicate Entries</button>
	</div>


<script> <!-- Holds all the grid information and scripts -->

	<!-- I know the scripts could be in a separate js file, but for now I am just keeping everything together.  -->

	function report_duplicates(){
		//I don't know what this is, but it's something
		//alert("Test -- " + args);
		var data = $("#jsGrid1").jsGrid;
		alert("Test -- " + data.name);
	}
	
	
	//Controller for run report button
	/*
	$('#run_report').click(function (args) {
		var data = $('jsGrid1').jsGrid('getrowdata', 1);
		alert('Test -- ' + args.item.ID);
	});
	*/
	
	
		
	
	
	

	//Data for table
    var tree_inv = [
		{"ID":"1","Address":"3728","Street":"Fishcreek  Rd","Side":"Front","Site":"1","Species":"Acer Rubrum","DBH":"21","Condition":"Good"},
		{"ID":"2","Address":"3728","Street":"Fishcreek  Rd","Side":"Front","Site":"2","Species":"Acer Rubrum","DBH":"18","Condition":"Fair"},
		{"ID":"3","Address":"3728","Street":"Fishcreek  Rd","Side":"Front","Site":"3","Species":"Acer Rubrum","DBH":"19","Condition":"Poor"},
		{"ID":"4","Address":"3728","Street":"Fishcreek  Rd","Side":"Front","Site":"3","Species":"Vacant Planting Site","DBH":"0","Condition":"N/A"},
		{"ID":"5","Address":"3728","Street":"Fishcreek  Rd","Side":"Front","Site":"4","Species":"Acer Rubrum","DBH":"20","Condition":"Dead"},
		{"ID":"6","Address":"3738","Street":"Fishcreek  Rd","Side":"Front","Site":"1","Species":"Vacant Planting Site","DBH":"0","Condition":"N/A"},
		{"ID":"7","Address":"3738","Street":"Fishcreek  Rd","Side":"Front","Site":"1","Species":"Fraxinus spp.","DBH":"12","Condition":"Dead"}
	];
	
	//Select / dropdown list for tree species
    var species_list = [
        { Name: "", Id: 0 },
        { Name: "Acer Rubrum", Id: 1 },
        { Name: "Fraxinus spp.", Id: 2 },
        { Name: "Vacant Planting Site", Id: 3 }
    ];
	
	//Select / dropdown list for tree condition
    var condition_list = [
        { Name: "", Id: 0 },
        { Name: "Good", Id: 1 },
        { Name: "Fair", Id: 2 },
        { Name: "Poor", Id: 3 },
        { Name: "Dead", Id: 4 },
        { Name: "N/A", Id: 5 }
    ];

	//This isn't implemented / doesn't work at the moment
	jsGrid.validators.custom = {
		message: function(value, item) {
			return "Custom -- " + item.count;
		},
		validator: function(value, item) {
			return false;
		}
    };	
	//This isn't implemented / doesn't work at the moment
    jsGrid.beforeSubmit = function(postdata) {
		alert("Test");
		return true;
	};


	//This is the beginning of the grid setup
    $("#jsGrid1").jsGrid({
        width: "100%",
        height: "300px",
 
        inserting: true,
        editing: true,
        sorting: true,
        paging: true,
		pageSize: 10,		//Leave this at 10 for now, maybe set to 5 when I submit
		//filtering: true,  //I don't know if I want this on for now / don't like the funcionality yet
        data: tree_inv,




		//This is where I'm working right now and doesn't work yet
		//I think we'll need the same function to be called on -onitemupdate- too
		//http://js-grid.com/docs/						-JS Grid Documentation
		//http://jsfiddle.net/tabalinas/rkxbgzrx/     -Maybe good examples
		//var myGrid = $("#jsGrid1").jsGrid.getName;	//This does stuff, keep for now
		
		
		//For this function, args is broken up into -grid- and -item-
		//-grid- is the entire grid - working on accessing this
		//-item- is the entry you're trying to work with		
		onItemInserting: function(args) {
			//var result = allow_changed_inventory(args.item.Species, args.item.DBH, args.item.Condition);
			//alert(result);
			if (!(allow_changed_inventory(args.item.Species, args.item.DBH, args.item.Condition))) {
				//Don't allow row to be edited/inserted
				args.cancel = true;
			}
		},
		onItemUpdating:  function(args) {
			//var result = allow_changed_inventory(args.item.Species, args.item.DBH, args.item.Condition);
			//alert(result);
			if (!(allow_changed_inventory(args.item.Species, args.item.DBH, args.item.Condition))) {
				//Don't allow row to be edited/inserted
				args.cancel = true;
			}
		}, 



		//Grid data setup / validation - validation is turned off
        fields: [
            { name: "ID", type: "number", width: 25, editing: false },
            { name: "Address", type: "number", width: 50
			//validate: {message: "Address field is required", validator: function(value) {return value > 0; } } 
	    },
            { name: "Street", type: "text", width: 150
			//validate: {message: "Street field is required", validator: function(value) {return value != ""; } } 
	    },
            { name: "Side", type: "text", width: 50
			//validate: {message: "Side field is required", validator: function(value) {return value != ""; } }
	    },
            { name: "Site", type: "number", width: 50
			//validate: {message: "Site field is required", validator: function(value) {return value != ""; } } 
	    },
            { name: "Species", type: "select", items: species_list, valueField: "Name", textField: "Name", width: 150,
			validate: {message: "Select species from list, required field", validator: function(value) {return value != ""; } }
	    },
            { name: "DBH", type: "number", width: 50
			//validate: {message: "DBH field is required, value greater than zero.", validator: function(value) {return value > 0; } }
	    },
            { name: "Condition", type: "select", items: condition_list, valueField: "Name", textField: "Name",
			validate: {message: "Select condition from list, required field", validator: function(value) {return value != ""; } }
	    },
            { type: "control" }
        ]
    });  //Ends jsGrid1


	<!-- Function to make sure that if (when add/edit a line) if species <> vacant, then user must have DBH>0 and condition <> "N/A"
	function allow_changed_inventory(check_species, check_DBH, check_condition) {

		//Get the N/A text from the condition list
		var NA_text = condition_list[5].Name;
		//Get the text from the species list
		var vacant_text = species_list[3].Name;
		
		//If the entry isn't a vacant tree input, we need to check to make sure user has input a CONDITION that isn't NA_text
		//and the DBH greater than 0
		if (check_species != vacant_text && check_species != "") {
			if (check_condition == NA_text || check_DBH <= 0) {
				//This will cancel the item update/insert
				alert('For any tree species that isn\'t vacant, DBH and condition are required.')
				return false;
			} 
		}
		//Otherwise, allow edit/insert to go through
		return true;
	};

	</script>
	
    </body>
</html>
























